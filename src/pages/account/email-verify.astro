---
export const prerender = false;
import AccountLayout from "@layouts/AccountLayout.astro";
import { createDirectusClient } from "@lib/directus";
import { registerUserVerify } from "@directus/sdk";

const searchParams = new URL(Astro.request.url).searchParams;
const token = searchParams.get("token");

let message = "";

let userNotice;
const notices = {
  sent: { text: "Email verification successful!", type: "success" },
  unknown: { text: "An unknown error occurred.", type: "error" },
  missing: { text: "No token provided for email verification.", type: "error" },
};

if (!token) {
  userNotice = notices.missing;
} else {
  try {
    const directus = createDirectusClient();
    await directus.request(registerUserVerify(token));
    userNotice = notices.sent;
  } catch (error) {
    console.error(error);
    userNotice = notices.unknown;
  }
}
---

<AccountLayout header="Email Verification"
  >{userNotice && userNotice.text}</AccountLayout
>

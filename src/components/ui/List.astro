---
export interface ItemProps {
  key: string;
  href?: string;
  label: string;
  subtitle?: string;
  image?: string;
  tag?: {
    label: string;
  };
}

export interface Props {
  items: ItemProps[];
  grid?: number;
  imageKey?: string;
  vertical?: boolean;
  class?: string;
}

const {
  items,
  imageKey,
  grid = 4,
  vertical = false,
  class: className = "",
} = Astro.props;

const cols = [
  `lg:grid-cols-0`,
  `lg:grid-cols-1`,
  `lg:grid-cols-2`,
  `lg:grid-cols-3`,
  `lg:grid-cols-4`,
  `lg:grid-cols-5`,
  `lg:grid-cols-6`,
];

const gridClass = grid ? `md:grid md:grid-cols-2 ${cols[grid]} gap-10` : "";

function getImageSrc(image: string, imageKey?: string): string {
  const search = imageKey ? `?key=${imageKey}` : "";
  return `https://content.northcray.org/assets/${image}${search}`;
}
---

<ul class={`list-none p-0 m-0 ${gridClass} ${className}`}>
  {
    items?.map((item) => {
      const imageEl = item.image ? (
        <img src={getImageSrc(item.image, imageKey)} alt="Image" />
      ) : null;

      const labelEl = <div class="text-lg font-semibold">{item.label}</div>;

      const subtitleEl = item.subtitle ? (
        <div class="line-clamp-2">{item.subtitle}</div>
      ) : null;

      const tagEl = item.tag ? (
        <div class="nc-tag w-min whitespace-nowrap">{item.tag.label}</div>
      ) : null;

      if (vertical) {
        return (
          <li class="py-4 flex gap-3 flex-col border-b-gray-300 dark:border-b-gray-700 border-b border-solid border-0">
            {item.href ? (
              <>
                <a
                  href={item.href}
                  class="nc-link nc-focus flex flex-col gap-3"
                >
                  {imageEl}
                  {labelEl}
                </a>
                {subtitleEl}
                {tagEl}
              </>
            ) : (
              <>
                {imageEl}
                {labelEl}
                {tagEl}
              </>
            )}
          </li>
        );
      }

      const content = imageEl ? (
        <>
          <div class="basis-1/3">{imageEl}</div>
          <div class="basis-2/3 gap-2 flex flex-col">
            {labelEl}
            {subtitleEl}
            {tagEl}
          </div>
        </>
      ) : (
        <div class="gap-2 flex flex-col">
          {labelEl}
          {subtitleEl}
          {tagEl}
        </div>
      );

      return (
        <li class="border-b-gray-300 dark:border-b-gray-700 border-b border-solid border-0">
          {item.href ? (
            <a
              href={item.href}
              class="flex flex-row gap-4 nc-link nc-focus py-4 h-full"
            >
              {content}
            </a>
          ) : (
            <div class="py-4 h-full">{content}</div>
          )}
        </li>
      );
    })
  }
</ul>
